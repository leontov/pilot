<!-- Copyright (c) 2024 Кочуров Владислав Евгеньевич -->

Kolibri Ω — Комплексный дизайн-документ, ТЗ и продуктовая спецификация

## Содержание
1. [Видение и миссия](#видение-и-миссия)
2. [Архитектура решения](#архитектура-решения)
   1. [Δ-VM v2 — десятичная виртуальная машина](#δ-vm-v2--десятичная-виртуальная-машина)
   2. [F-KV v2 — фрактальная память base-10](#f-kv-v2--фрактальная-память-base-10)
   3. [Синтез знаний](#синтез-знаний)
   4. [Блокчейн знаний](#блокчейн-знаний)
   5. [Сеть (роевой разум)](#сеть-роевой-разум)
   6. [Web UI «Kolibri Studio»](#web-ui-kolibri-studio)
3. [Публичный API (HTTP)](#публичный-api-http)
4. [Ключевые показатели](#ключевые-показатели)
5. [Дорожная карта (спринты)](#дорожная-карта-спринты)
6. [Структура репозитория](#структура-репозитория)
7. [Демо-сценарии](#демо-сценарии)
8. [Единая команда запуска](#единая-команда-запуска)
9. [Ограничения и допущения](#ограничения-и-допущения)
10. [План реализации: ключевые задачи и артефакты](#план-реализации-ключевые-задачи-и-артефакты)
11. [Организация команды и процессов](#организация-команды-и-процессов)
12. [Вводные данные и риски](#вводные-данные-и-риски)
13. [Готовность к демонстрации](#готовность-к-демонстрации)
14. [Резюме](#резюме)

## Видение и миссия
* Создать новый класс искусственного интеллекта, работающего исключительно с десятичными цифрами и формулами, без традиционных весов и матричной алгебры.
* Доставить компактное ядро (≤ 50 МБ), запуск которого возможен на широкой линейке устройств, обеспечивая диалог, самообучение, синтез знаний и сетевой обмен.
* Предоставить инвесторам и партнёрам демонстрацию класса «world-class»: полную, стабильную и воспроизводимую.

## Архитектура решения

### Δ-VM v2 — десятичная виртуальная машина
* **Инструкции:** `PUSHd`, `ADD10`, `SUB10`, `MUL10`, `DIV10`, `CMP`, `JZ/JNZ`, `CALL/RET`, `READ_FKV`, `WRITE_FKV`, `HASH10`, `RANDOM10`, `TIME10`, `HALT`.
* **Модель:** стековая, строго детерминированная. Газ-лимиты исключают бесконечные циклы.
* **Трассировка:** пошаговый JSON-лог с регистрами, стеком и последними операциями для обучения и отладки.
* **Производительность:** P95 исполнения программы длиной 256 шагов < 50 мс на x86-64/ARM.
* **Реализация:** C, threaded interpreter с таблицей переходов и опциональным JIT для критичных путей.

### F-KV v2 — фрактальная память base-10
* **Структура:** 10-арный trie, каждая вершина хранит top-K элементов (программы, факты) по префиксу.
* **Типы памяти:**
  * Эпизодическая (диалоги, события).
  * Семантическая (факты, формулы, связи).
  * Процедурная (байткод Δ-VM).
* **API:** `fkv_put`, `fkv_put_scored`, `fkv_get_prefix`, `fkv_topk_programs`.
* **Сжатие:** десятичное арифметическое кодирование для компактного хранения.
* **Цели:** ≥ 1 млн ключей, P95 GET < 10 мс.

### Синтез знаний
* **Парадигма:** знание = программа, обучение весов отсутствует.
* **Техники:** length-lexicographic перебор, MCTS, генетический поиск, peephole-оптимизации, sketching, частичная специализация.
* **Метрика качества:** `Score = W1 * PoE – W2 * MDL – W3 * Runtime – W4 * GasUsed`.
* **Продакшен-ворота:** только программы, улучшающие PoE и снижающие MDL, проходят допуск.

### Блокчейн знаний
* **Формат блока:** `{prev_hash, time10, program_ids[], PoE_stats, MDL_delta, nonce}`.
* **Консенсус:** Proof-of-Use (PoU) — блок принимается при PoE ≥ τ.
* **Синхронизация:** gossip + CRDT OR-Set.
* **Безопасность:** подписи Ed25519, целостность HMAC-SHA256.

### Сеть (роевой разум)
* **Кадры:** `HELLO`, `PING`, `PROGRAM_OFFER`, `BLOCK_OFFER`, `FKV_DELTA`; все поля — десятичные байты.
* **Управление трафиком:** лимиты частоты, репутация по доле полезных блоков.

### Web UI «Kolibri Studio»
* **Технологии:** Vite + React (SPA).
* **Вкладки:** Диалог, Память (F-KV Explorer), Программы (редактор + трассировка Δ-VM), Синтез (лог поиска), Блокчейн (цепочка/блоки), Кластер (состояние соседей), Бенчмарки.
* **Цель:** живой контроль, демонстрация и управление ИИ.

## Публичный API (HTTP)
* `POST /api/v1/dialog {input} → {answer, trace}`
* `POST /api/v1/vm/run {program} → {result, trace}`
* `GET /api/v1/fkv/get?prefix=... → {values[], programs[]}`
* `POST /api/v1/program/submit {bytecode} → {PoE, MDL, score}`
* `POST /api/v1/chain/submit {program_id} → {status}`
* `GET /api/v1/health|metrics → {uptime, memory, peers, blocks}`

## Ключевые показатели
* Размер ядра ≤ 50 МБ, холодный старт < 300 мс.
* Время ответа P95 < 50 мс.
* Автоулучшение: рост PoE ≥ 20 % за ночь.
* ≥ 90 % блоков проходят повторную проверку.
* Репликация знаний в сети < 3 с.
* 24 ч непрерывной работы без утечек (ASAN/UBSAN clean).

## Дорожная карта (спринты)
### Спринт A (3 недели) — ядро
* Δ-VM v2, F-KV v2.
* Реализация метрик PoE/MDL.
* HTTP API v1.
* Kolibri Studio v1: Диалог + Память.
* CI: линтеры, unit-тесты для VM/F-KV.

### Спринт B (3 недели) — сеть и синтез
* Расширение сетевого стека, реализация синтеза и PoU-консенсуса.
* Интеграция блокчейна знаний, наблюдение за репутацией.
* Расширенные интеграционные тесты и бенчмарки.

### Спринт C (3 недели) — продукт и масштабирование
* Kolibri Studio: новые вкладки (синтез, блоки, кластер, бенчмарки).
* Облачные развёртывания, наблюдаемость, профилирование.
* Whitepaper, демо-сценарии, подготовка презентаций.

## Структура репозитория
```
/src          # Ядро Kolibri Ω
  /vm         # Δ-VM
  /fkv        # Фрактальная память
  /synthesis  # Синтез программ
  /chain      # Блокчейн знаний
  /protocol   # Сетевые кадры
  /http       # HTTP сервер и маршруты
/web          # Kolibri Studio (React + Vite)
/tests        # Unit, property, fuzz, интеграционные тесты
kolibri.sh    # Скрипт «всё в одном»
CMakeLists.txt
README.md
```

## Демо-сценарии
1. **Арифметика:** запрос «2+2» → Δ-VM вычисляет результат 4.
2. **Запоминание факта:** «Запомни, что Москва — столица России» → запись в F-KV.
3. **Воспоминание:** «Вспомни столицу России» → ответ «Москва».
4. **Сетевой обмен:** сосед присылает программу с PoE = 0.95 → валидируем, добавляем в блок, рассылаем.

## Единая команда запуска
```
./kolibri.sh up
  ├─ сборка ядра (C)
  ├─ сборка web (Vite/React)
  ├─ запуск узла (http://localhost:9000)
  └─ открытие Kolibri Studio
```

## Ограничения и допущения
* Никаких внешних LLM, нейросетевых весов или матричных операций.
* Все знания — десятичные цифры, формулы, программы Δ-VM и блоки.
* Внешние вызовы из Δ-VM запрещены (песочница).
* Основной обмен знаниями — через F-KV и блокчейн.

## План реализации: ключевые задачи и артефакты
### Δ-VM v2
* Спецификация инструкций, формат bytecode.
* Тестовый набор программ (арифметика, логика, доступ к F-KV).
* Отладчик/трассировщик (JSON).

### F-KV v2
* Реализация trie, сериализация, компрессия.
* API для хранения фактов, эпизодов, программ.
* Инструменты анализа (top-K, префиксный поиск).

### Синтез знаний
* Оркестратор задач.
* Библиотека операторов.
* Метрики качества (PoE, MDL, Runtime, GasUsed).
* Репозитории формул/программ.

### Блокчейн знаний
* Формирование блоков, валидация PoU.
* Согласование цепочки, репликация.
* Хранилище блоков.

### Сеть
* Протокол обмена кадрами (`HELLO`, `PING`, `PROGRAM_OFFER` и др.).
* Управление соединениями, репутация узлов.
* Логи и мониторинг.

### Kolibri Studio
* UI-компоненты для каждой вкладки.
* Интеграция с HTTP API.
* Трассировка Δ-VM, просмотр памяти, сетевой статус.

### Инфраструктура
* Сборка (CMake/Make + Vite).
* CI/CD (lint, unit, fuzz, интеграционные тесты).
* Документация и скрипты деплоя.

## Организация команды и процессов
* **Команды:** ядро (VM, F-KV), синтез и блокчейн, сеть, продукт/UX, DevOps/QA.
* **Стандарты качества:** code review, покрытие тестами, статический анализ, профилирование.
* **Коммуникации:** недельные демо, burn-down, канбан, документация в Wiki.

## Вводные данные и риски
* **Исходные ресурсы:** существующая база Kolibri, спецификации Δ-VM v1/F-KV v1, опыт команды.
* **Технические риски:** производительность trie, сложность синтеза, безопасность протокола. Смягчение — прототипы, профили, фаззинг, code audit.
* **Правовые аспекты:** патентная подача, соответствие экспортному контролю.

## Готовность к демонстрации
* Все API соответствуют требованиям по времени, формату и стабильности.
* Kolibri Studio демонстрирует все обязательные сценарии.
* Сеть устойчиво синхронизирует знания.
* Документация (README Pro, Whitepaper, API Spec) завершена.
* Проведены нагрузки, профилирование, тесты безопасности.
* Подготовлены презентационные материалы и сценарии запуска.

## Резюме
Kolibri Ω — целостная архитектура и план создания нового типа ИИ на десятичных цифрах и формулах. Документ описывает каждый компонент (Δ-VM, F-KV, синтез, блокчейн знаний, сеть, UI), цели, KPI, дорожную карту и подготовку продукта уровня «world-class demo». Передача этой спецификации команде обеспечивает запуск воспроизводимого и масштабируемого продукта без дополнительных интерпретаций.
